% Показатели эффективности декомпозиции сетки.
\subsection{Показатели качества декомпозиции неструктурированной расчетной сетки}

Высокопроизводительные вычисления, выполняющиеся на расчетных сетках, как правило, состоят из большого количества отдельных итераций по времени, на каждой из которых обрабатываются все ячейки сетки, а между итерациями соседние ячейки обмениваются информацией на общей границе.
Сначала рассмотрим одну итерацию расчетов без учета информационных обменов.
Рассмотрим расчетную сетку, содержащую $n$ ячеек, и которую требуется декомпозировать для обработки на $k$-процессорном вычислительном кластере.
Все ячейки расчетной сетки могут обрабатываться параллельно.
Будем считать, что все ячейки являются одинаковыми с точки зрения времени их обработки.
Если разбить расчетную сетку на $k$ доменов с одинаковым количеством ячеек и обрабатывать каждый домен на отдельном процессоре, то обработка каждого домена на одной итерации будет занимать одно и то же время.
Так как обработка всех доменов будет производиться параллельно, то это время и будет временем, затрачиваемым на одну итерацию обработки всех ячеек сетки.
Если распределение ячеек сетки по доменам будет неравномерным, то время выполнения одной итерации расчетов будет определяться самым крупным доменом (так как время его обработки будет максимальным).
Таким образом, в качестве показателя качества декомпозиции сетки можно принять максимальное абсолютное отклонение размера домена от теоретически возможного среднего значения
\begin{equation}
	D = \max_{1 \le i \le k}{ \left( n_i - \frac{n}{k} \right) },
\end{equation}
 
где $n_i$ – количество ячеек в $i$-ом домене.
В идеальном случае равномерного распределения ячеек по доменам показатель $D$ становится равным нулю.
В худшем случае все ячейки распределяются в один домен и $D = n \left( 1 - \frac{1}{k} \right)$.

Так как абсолютный показатель не слишком удобен для сравнения разных алгоритмов декомпозиции на разных сетках, то дополнительно будем использовать показатель, который характеризует долю накладных расходов неравномерного распределения ячеек по доменам по отношении к идеальному распределению, а именно
\begin{equation}
	D^{*} = \frac{D}{n / k}
\end{equation}

\

Значение $D^{*}$ изменяется в диапазоне $[0, k - 1]$, где $D^{*} = 0$ означает идеальное распределение ячеек по доменам, а $D^{*} = k - 1$ соответствует наихудшему случаю, когда все ячейки отнесены к одному домену.

После завершения итерации расчетов требуется произвести информационные обмены данными на границах доменов.
Так как мы считаем, что каждый домен обрабатывается на своем процессоре, то информационный обмен происходит с использованием механизмов межпроцессного взаимодействия (например, с использованием MPI).
Таким образом, для каждой пары доменов, имеющих общую границу необходимо организовывать межпроцессный обмен.
Все такие обмены могут происходить одновременно, и общее затрачиваемое на них время определяется длиной максимальной общей границы между доменами.
Для учета информационных обменов рассмотрим дуальный граф расчетной сетки, вершинами которого являются ячейки сетки.
Две вершины в дуальном графе соединены ребром, если две соответствующие ячейки являются соседними (имеют общую грань).
Множество ребер дуального графа обозначим через $E$, а для каждого отдельного ребра $e$ под $e_a$ и $e_b$ будем понимать инцидентные ему вершины.
Тогда в качестве второй характеристики качества декомпозиции будем использовать величину наиболее протяженной границы между парой доменов, или
\begin{equation}
	\begin{aligned}
		& L_{ij} = \left| \{ e \in E: \{ d(e_a), d(e_b) \} = \{ i, j \} \} \right| \\
		& L = \max_{1 \le i < j \le k}{L_{ij}}
	\end{aligned}
\end{equation}

где $d(v)$ -- домен, к которому относится вершина $v$.
В идеальном случае значение характеристики $L$ может быть сколь угодно малым, даже нулевым (в случае, если сетка представляет собой $k$ одинаковых по количеству ячеек несвязных областей).
В наихудшем случае случае $L = |E|$, если ячейки распределены в два домена в шахматном порядке, и каждое ребро относится к границе между этими двумя доменами.

Наряду с показателем $L$ используется нормированный показатель $L^{*}$, определяемый как
\begin{equation}
	L^{*} = \frac{L}{|E|},
\end{equation}

который изменяется в диапазоне $[0, 1]$ и принимает значение 0 в идельном случае, а 1 -- в наихудшем.

В роли дополнительной характеристики качества декомпозиции можно использовать суммарную длину границ между доменами
\begin{equation}
	I = \sum_{1 \le i < j \le k}{L_{ij}},
\end{equation}

что соответствует общему количеству пересылаемых данных в рамках межпроцессного обмена.

Так как домены граничат между собой по ребрам, то суммарная длина всех границ между доменами представляет собой просто количество всех ребер, инцидентных двум относящимся к разным доменам ячейкам (междоменные ребра).
Наряду с показателем $I$ будем использовать долю междоменных ребер среди общего количества ребер сетки
\begin{equation}
	I^{*} = \frac{I}{|E|}
\end{equation}

Показатель $I^{*}$ также является нормированным, он изменяется в диапазоне $[0, 1]$ и принимает значение 0 в идеальном случае и 1 -- в наихудшем.

Для разных задач перечисленные характеристики качества декомпозиции могут иметь различную важность.
Как правило, обработка ячеек занимает основное время высокопроизводительных расчетов, и параметр $D$ более критичен.
Однако, в некоторых случаях вычислительная процедура настолько легковесная, что основные расходы приходятся на межпроцессные обмены.
Например, в работе \cite{Tong2017Remesh} описан алгоритм сглаживания поверхностной расчетной сетки, для которого при распараллеливании по MPI расходы на информационные обмены значительно превышают расходы на вычисления внутри ячеек.
Вместо отдельных показателей качества декомпозиции, можно использовать единый показатель с весовыми коэффициентами и с произвольным набором показателей $D$, $D^{*}$, $L$, $L^{*}$, $I$, $I^{*}$, например
\begin{equation}
	Q(\delta, \lambda, \iota) = \delta D^{*} + \lambda L^{*} + \iota I^{*}
\end{equation}

При выборе алгоритма декомпозиции следует стремиться к уменьшению значения показателя $Q$.
