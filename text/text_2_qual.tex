% Показатели эффективности декомпозиции сетки.
\subsection{Показатели качества декомпозиции}

Высокопроизводительные вычисления, выполняющиеся на расчетных сетках, как правило, состоят из большого количества отдельных итераций по времени, на каждой из которых обрабатываются все ячейки сетки, а между итерациями соседние ячейки обмениваются информацией на общей границе.
Сначала рассмотрим одну итерацию расчетов без учета информационных обменов.
Рассмотрим расчетную сетку, содержащую $n$ ячеек, и которую требуется декомпозировать для обработки на $k$-процессорном вычислительном кластере.
Все ячейки расчетной сетки могут обрабатываться параллельно.
Будем считать, что все ячейки являются одинаковыми с точки зрения времени их обработки.
Если разбить расчетную сетку на $k$ доменов с одинаковым количеством ячеек и обрабатывать каждый домен на отдельном процессоре, то обработка каждого домена на одной итерации будет занимать одно и то же время.
Так как обработка всех доменов будет производиться параллельно, то это время и будет временем, затрачиваемым на одну итерацию обработки всех ячеек сетки.
Если распределение ячеек сетки по доменам будет неравномерным, то время выполнения одной итерации расчетов будет определяться самым крупным доменом (так как время его обработки будет максимальным).
Таким образом, в качестве показателя качества декомпозиции сетки можно принять максимальное абсолютное отклонение размера домена от теоретически возможного среднего значения
\begin{equation}
	D = \max_{1 \le i \le k}{ \left( n_i - \frac{n}{k} \right) },
\end{equation}
 
где $n_i$ – количество ячеек в $i$-ом домене.
В идеальном случае равномерного распределения ячеек по доменам показатель $D$ становится равным нулю.

Наряду с показателем $D$ будем использовать относительное отклонение от возможного среднего значения, а именно
\begin{equation}
	D^{*} = \frac{D}{n/k}.
\end{equation}

После завершения итерации расчетов требуется произвести информационные обмены данными между парами соседних ячеек.
Если ячейки находятся в одном домене, то такой обмен не представляет проблем.
Если же ячейки относятся к разным доменам, то информационный обмен происходит с использованием механизмов межпроцессного взаимодействия (например, с использованием MPI).
Таким образом, для каждой пары доменов, имеющих общую границу необходимо организовывать межпроцессный обмен.
Все такие обмены могут происходить одновременно, и общее затрачиваемое на них время определяется длиной максимальной общей границы между доменами.
Для учета информационных обменов рассмотрим дуальный граф расчетной сетки, вершинами которого являются ячейки сетки.
Две вершины в дуальном графе соединены ребром, если две соответствующие ячейки являются соседними (имеют общую грань).
Множество ребер дуального графа обозначим через $E$, а для каждого отдельного ребра $e$ под $e_a$ и $e_b$ будем понимать инцидентные ему вершины.
Тогда в качестве второй характеристики качества декомпозиции будем использовать величину наиболее протяженной границы между парой доменов, или
\begin{equation}
	\begin{aligned}
		& L_{ij} = \left| \{ e \in E: \{ d(e_a), d(e_b) \} = \{ i, j \} \} \right| \\
		& L = \max_{1 \le i < j \le k}{L_{ij}}
	\end{aligned}
\end{equation}

где $d(v)$ -- домен, к которому относится вершина $v$.
В идеальном случае значение характеристики $L$ может быть сколь угодно малым, даже нулевым (в случае, если сетка представляет собой $k$ одинаковых по количеству ячеек несвязных областей).
В роли дополнительной характеристики качества декомпозиции можно использовать суммарную длину границ между доменами
\begin{equation}
	I = \sum_{1 \le i < j \le k}{L_{ij}},
\end{equation}

что соответствует общему количеству пересылаемых данных в рамках межпроцессного обмена.

Так как домены граничат между собой по ребрам, то суммарная длина всех границ между доменами представляет собой просто количество всех ребер, инцидентных двум относящимся к разным доменам ячейкам (междоменные ребра).
Наряду с показателем $I$ будем использовать долю междоменных ребер среди общего количества ребер сетки
\begin{equation}
	I^{*} = \frac{I}{|E|},
\end{equation}

где $E$ -- множество всех ребер расчетной сетки.

Для разных задач перечисленные характеристики качества декомпозиции могут иметь различную важность.
Как правило, обработка ячеек занимает основное время высокопроизводительных расчетов, и параметр $D$ более критичен.
Однако, в некоторых случаях вычислительная процедура настолько легковесная, что основные расходы приходятся на межпроцессные обмены.
Например, в работе \cite{Tong2017Remesh} описан алгоритм сглаживания поверхностной расчетной сетки, для которого при распараллеливании по MPI расходы на информационные обмены значительно превышают расходы на вычисления внутри ячеек.
В дальнейшем мы не будем рассматривать характеристику $I$, а вместо первых двух характеристик использовать единый взвешенный показатель качества декомпозиции $Q = \delta D + \lambda L$ с произвольными значениями весов $\delta$ и $\lambda$.
